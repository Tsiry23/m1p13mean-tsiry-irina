Terminons avec celui là :

router.get("/histo-loyer", async (req, res) => {
  try {
    const {
      id_boutique,
      date_debut,
      date_fin,
      page = 1,
      limit = 10
    } = req.query;

    const pageNum = parseInt(page);
    const limitNum = parseInt(limit);
    const skip = (pageNum - 1) * limitNum;

    // période par défaut = mois courant
    let startDate, endDate;

    if (date_debut && date_fin) {
      startDate = new Date(date_debut);
      endDate = new Date(date_fin);
      endDate.setHours(23, 59, 59, 999);
    } else {
      const now = new Date();
      startDate = new Date(now.getFullYear(), now.getMonth(), 1);
      endDate = new Date(
        now.getFullYear(),
        now.getMonth() + 1,
        0,
        23, 59, 59, 999
      );
    }

    // ✅ construction dynamique du filtre
    const filter = {
      date_changement: {
        $gte: startDate,
        $lte: endDate
      }
    };

    // ✅ filtre boutique optionnel
    if (id_boutique) {
      filter.id_boutique = id_boutique;
    }

    const [total, data] = await Promise.all([
      HistoLoyer.countDocuments(filter),
      HistoLoyer.find(filter)
        .populate("id_boutique", "nom")
        .sort({ date_changement: -1 })
        .skip(skip)
        .limit(limitNum)
    ]);

    res.json({
      page: pageNum,
      limit: limitNum,
      total,
      totalPages: Math.ceil(total / limitNum),
      data
    });

  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "Erreur serveur" });
  }
});

On fait comme tout à l'heure pour les étapes.
Les modèles 
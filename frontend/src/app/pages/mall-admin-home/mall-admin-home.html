<div class="layout" id="container">
  <app-mall-admin-sidebar></app-mall-admin-sidebar>

  <main class="content align-items-start text-start">
    <h1 class="mb-4">Tableau de bord</h1>

    <div *ngIf="loading" class="text-muted">Chargement des métriques...</div>

    <div class="row g-3 w-100" *ngIf="metrics">
      <div class="col-md-4">
        <div class="card metric-card bg-primary text-white">
          <div class="card-body">
            <h6>Total boutiques</h6>
            <h3>{{ metrics.totalBoutiques }}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card metric-card bg-success text-white">
          <div class="card-body">
            <h6>Boutiques actives</h6>
            <h3>{{ metrics.boutiquesActives }}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card metric-card bg-info text-white">
          <div class="card-body">
            <h6>Taux d’occupation</h6>
            <h3>{{ metrics.tauxOccupation }} %</h3>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card metric-card bg-warning text-dark">
          <div class="card-body">
            <h6>Loyer attendu</h6>
            <h3>{{ metrics.loyerAttendu | number: '1.0-0' }} Ar</h3>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card metric-card bg-success text-white">
          <div class="card-body">
            <h6>Total payé</h6>
            <h3>{{ metrics.totalPaye | number: '1.0-0' }} Ar</h3>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card metric-card bg-danger text-white">
          <div class="card-body">
            <h6>Reste à recevoir</h6>
            <h3>{{ metrics.resteARecevoir | number: '1.0-0' }} Ar</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="card mt-4 w-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Évolution des paiements</h5>

        <div class="d-flex gap-2">
          <!-- Année -->
          <select
            class="form-select form-select-sm"
            [(ngModel)]="selectedYear"
            (change)="loadPaiementEvolution()"
          >
            <option *ngFor="let y of [2023, 2024, 2025, 2026]" [value]="y">
              {{ y }}
            </option>
          </select>

          <!-- Boutique -->
          <select
            class="form-select form-select-sm"
            [(ngModel)]="selectedBoutiqueId"
            (change)="loadPaiementEvolution()"
          >
            <option [ngValue]="null">Toutes les boutiques</option>
            <option *ngFor="let b of boutiques" [value]="b._id">
              {{ b.nom }}
            </option>
          </select>
        </div>
      </div>

      <div class="card-body">
        <div *ngIf="loadingEvolution" class="text-muted">Chargement du graphique...</div>

        <canvas id="paiementChart" height="120"></canvas>
      </div>
    </div>
  </main>
</div>
